const i18nConfig = {
  'en-US': {
    'i18n-03191i2b': 'User',
'i18n-03ln0qu5': 'Reason for failure',
    'i18n-07elef67': 'Maintainer',
    'i18n-0g29qv4h': 'Developer',
'i18n-0qv5agal': 'Built-in warehouse',
    'i18n-10w4t63g': 'be',
    'i18n-11r38hcr': 'Component warehouse address',
    'i18n-1nghn80e': 'Built-in repositories are not editable',
    'i18n-1nuuys6g': 'abnormal',
    'i18n-1t6r3z9g': 'healthy',
    'i18n-21sko24b': 'Pathname',
'i18n-2n1c4oog': 'Built-in repositories can only be deleted by system administrators',
    'i18n-3e6ypkso': 'Page title',
    'i18n-3fii1xqj':
      'A unique identifier of the component, which cannot be modified after it is created',
'i18n-41nz9vbg': 'The version number is malformed',
    'i18n-46h4uuzv': 'Page setting',
'i18n-46pmimcv': 'The warehouse address format is incorrect',
    'i18n-4guh56tw': 'Please select a label',
    'i18n-4oewgn1j': 'Page ID',
    'i18n-4sb1nxis': 'Members manage',
    'i18n-4yz69icb': 'Select Release repository',
    'i18n-52w3n9hq': 'flushed',
    'i18n-58purxk8': 'Latest commit',
'i18n-59n3gmuw': 'Release Version:',
    'i18n-5it1hw2u': 'Please enter the version number, for example, 0.0.1',
    'i18n-5mgs0dts':
      'Apply the name (namespace), where the app name is the name of the component after it is published to the component repository',
    'i18n-5ozgrwse': 'Are you sure you want to delete this release record?',
    'i18n-5pd068z7': 'Release time',
    'i18n-5sf2v33a': 'Please be patient while the app is being published',
    'i18n-5tqo0ca8': 'The built-in repository is suitable for all applications of the platform',
    'i18n-6ajtknut': 'Publish to a repository',
    'i18n-6me4bk3g': 'The unique identifier of the application, once created, cannot be modified.',
    'i18n-6t2leoby': 'Please input filename',
    'i18n-7m8cg2t3': 'Component name',
'i18n-7q5i93tv': 'Submission time',
    'i18n-7v35tkdj': 'More',
    'i18n-8aq0hr2j': 'Filename',
'i18n-8ed1z1oe': 'The edit group repository succeeded',
    'i18n-8hwlwfxt': 'New page',
'i18n-8x2ne1ec': 'Please enter a username',
    'i18n-90ht7c6d': 'Join time',
    'i18n-9jxz166x': 'Pages manage',
    'i18n-a0i21b3y': 'Create',
    'i18n-a7dfj5mr': 'Template',
'i18n-aaesfoga': 'Component warehouse status',
    'i18n-aceiy2fy': 'Add members',
    'i18n-aldyt5z9':
      'By 3~63 characters, underscore "_", hyphen "-" or dot "." composition, and begins or ends with a character',
    'i18n-ahv8j8b8': 'Please select a branch',
    'i18n-b2ei9j2f': 'Create branch',
'i18n-buh24m5l': 'Please enter a password',
    'i18n-cdepvr38': 'New app',
'i18n-cmfovsoe':
      'It consists of 50 letters, numbers, dot ".", hyphenated "-" or plus sign "+", and must start with a number and end with a number or letter',
    'i18n-ct3q2502': 'Current status',
    'i18n-cz07vq08': 'flushed',
    'i18n-d2brlroc': 'Update at',
    'i18n-d9cz9maq':
    'Please enter the address of the warehouse, example http://192.168.1.1:80/repository',
    'i18n-duipg1h3': 'View',
    'i18n-dvhhy4bz': 'Publishing',
    'i18n-etgx4cun': 'Cancel',
    'i18n-g1vk6fk1': 'Enter the repository name to search',
    'i18n-gklza56m': 'Add a component repository',
    'i18n-fmetyy4f': 'Branch management',
    'i18n-gnabgk8z': 'Commiter',
    'i18n-godkp0bg':
      'The naming of the page file used when the code is out must meet the naming requirements of the big hump of React components',
'i18n-gu28o58e': 'Please select the warehouse first',
    'i18n-hd27um9e': 'Synchronously delete all release records for the current repository',
    'i18n-hu8a4zhq': '测试',
'i18n-i44aj3t5': 'Warehouse address',
    'i18n-iiikgh5p': 'App name',
    'i18n-io50zahr': 'Design page',
    'i18n-it3zdrk8': 'Delete',
'i18n-j30tafiu': 'Publishing the app failed',
    'i18n-j8ze773g': 'The component repository was deleted successfully',
    'i18n-jrlkaisr': 'password',
    'i18n-jw5stbdu':
      'There is no version yet, you can click Publish after the component design is completed',
'i18n-jwiudi2n': 'Publishing status',
    'i18n-kzc8hlof': 'Source branch',
    'i18n-l30ktk9c': 'Apps management',
    'i18n-l3bqhr6f': 'Props setting',
    'i18n-l8bqf47j': 'New component',
    'i18n-laqlm1vs': 'Pipeline ID',
    'i18n-lc0lwakk': 'Please select a branch or version',
    'i18n-lh9r0aur': 'The name must not duplicate other applications.',
'i18n-m63pnjjo': 'Failed to add component repository',
    'i18n-mocj3t8i': 'New branch  name',
'i18n-my0gyopa': 'Duplicate repository names',
    'i18n-n65mm74u': 'User name',
    'i18n-na2etfio': 'Name',
    'i18n-nk3u5cap': 'Versions management',
    'i18n-o0ei2yue': "Don't have a page yet, click the Add button to create it",
'i18n-o241k589': 'View the component repository',
    'i18n-o8oudbt6': 'Publishing failed',
    'i18n-oqzjt4q8': 'Component ID',
    'i18n-pf9ss9vm': 'Description',
    'i18n-prfr37uo': 'Design component',
'i18n-ptgr3r7b': 'Component warehouse management',
    'i18n-q05eb4ej': 'Release name',
    'i18n-q95aq41k': 'The deletion of the publish record was successful',
    'i18n-qd0chypg': 'Please select CommitId',
    'i18n-qqphansg': 'Components management',
'i18n-qsr81tga': 'not',
    'i18n-qxi7rhuh': 'Are you sure',
    'i18n-rai2jazr': 'Namespace',
    'i18n-s4uc3qfq': 'Owner',
    'i18n-scef9t49': 'Preview in new page',
    'i18n-sivgv5vw': 'Commit message',
'i18n-sk0zlonj': 'Please enter the CommitId',
    'i18n-sk2miz3l': 'input member name to search',
    'i18n-t3krslmt': 'Reporter',
'i18n-tbc50yra': 'Publisher',
    'i18n-tnmitd0v': 'Publish records',
    'i18n-twtfn0kc': 'Component repository name',
    'i18n-u58088zr': 'Delete the component repository',
    'i18n-ubf2zl9c': ', publish to the repository:',
    'i18n-uel9pjrj': 'Operate',
'i18n-uhih9oip': 'The component repository was added successfully',
    'i18n-uk1rth4d': 'Delete the publication record',
    'i18n-ukhgf87d': 'Please enter the warehouse address',
    'i18n-umtxjgit': 'Please input page pathname',
    'i18n-usdl74qf': 'Failed to edit component repository',
    'i18n-uu6jp4fr': 'Publish the baseline',
    'i18n-uvtyr9de': 'Updated by',
    'i18n-unauzwfe': 'Total',
    'i18n-v88cpaiy': 'App ID',
    'i18n-vc1z00ab': 'Member name',
'i18n-vcavv6ts': 'Release version',
    'i18n-vmthidgk': 'Publish the app',
    'i18n-w3sx3iid': 'Shut down',
    'i18n-w5yp1cx8': 'The release was successful',
    'i18n-w6uloaol': 'Make sure to delete the component repository',
    'i18n-w80normr': 'Please enter the version number',
    'i18n-wjytn4ph': 'Please enter a component repository name',
    'i18n-wo5d5bsf': 'Please select a branch',
    'i18n-wkyhbxzj': 'strip',
    'i18n-wtpamquq': 'Guest',
    'i18n-x0whqlmr': 'Remove member',
    'i18n-xgcwv3vl': 'Please input page title',
    'i18n-xm8m9oms': 'Branch name',
    'i18n-xvkn1o65': 'Role',
    'i18n-xwmo3gdd': 'Is it?',
    'i18n-xx5cxe33': 'Edit the component repository',
    'i18n-yhtaj9mp': 'Create at',
    'i18n-ynxzg8x9': 'edit',
    'i18n-zbrcaqqo':
      "App namespace path can contain only letters, digits, '_', '-' and '.'. Cannot start with '-', end in '.git' or end in '.atom'",
'i18n-zkqmzk1j': 'Helm repositories of the Chart Museum type are currently supported',
    'i18n-zupi1oqq': 'This version has been published, please modify the version number to publish',
  },
  'zh-CN': {
    'i18n-03191i2b': '用户',
'i18n-03ln0qu5': '失败原因',
    'i18n-07elef67': '维护者',
    'i18n-0g29qv4h': '开发者',
'i18n-0qv5agal': '内置仓库',
    'i18n-10w4t63g': '是',
    'i18n-11r38hcr': '组件仓库地址',
    'i18n-1nghn80e': '内置仓库不可编辑',
    'i18n-1nuuys6g': '异常',
    'i18n-1t6r3z9g': '健康',
    'i18n-21sko24b': '页面路由',
'i18n-2n1c4oog': '内置仓库仅系统管理员可以删除',
    'i18n-3e6ypkso': '页面标题',
    'i18n-3fii1xqj': '组件的唯一标识，创建后不能修改',
'i18n-41nz9vbg': '版本号格式不正确',
    'i18n-46h4uuzv': '页面设置',
'i18n-46pmimcv': '仓库地址格式不正确',
    'i18n-4guh56tw': '请选择标签',
    'i18n-4oewgn1j': '页面 ID',
    'i18n-4sb1nxis': '成员管理',
    'i18n-4yz69icb': '请选择发布仓库',
    'i18n-52w3n9hq': '刷新',
    'i18n-58purxk8': '最后的提交',
'i18n-59n3gmuw': '发布版本：',
    'i18n-5it1hw2u': '请输入版本号，例 0.0.1',
    'i18n-5mgs0dts': '应用该名称（命名空间），其中应用名称即发布到组件仓库后的组件名称',
    'i18n-5ozgrwse': '确定删除此条发布记录？',
    'i18n-5pd068z7': '发布时间',
    'i18n-5sf2v33a': '应用发布中，请耐心等待',
    'i18n-5tqo0ca8': '内置仓库适用于平台所有应用',
    'i18n-6ajtknut': '发布至仓库',
    'i18n-6me4bk3g': '应用的唯一标识，创建后不能修改',
    'i18n-6t2leoby': '请输入页面文件名',
    'i18n-7m8cg2t3': '组件名称',
'i18n-7q5i93tv': '提交时间',
    'i18n-7v35tkdj': '更多',
    'i18n-8aq0hr2j': '文件名',
'i18n-8ed1z1oe': '编辑组仓库成功',
    'i18n-8hwlwfxt': '新增页面',
'i18n-8x2ne1ec': '请输入用户名',
    'i18n-90ht7c6d': '加入时间',
    'i18n-9jxz166x': '页面管理',
    'i18n-a0i21b3y': '创建',
    'i18n-a7dfj5mr': '模板',
'i18n-aaesfoga': '组件仓库状态',
    'i18n-aceiy2fy': '添加成员',
    'i18n-aldyt5z9': '由3~63位字符、下划线“_”、中划线“-”或点“.”组成，并以字符开头或结尾',
    'i18n-ahv8j8b8': '请选择分支',
    'i18n-b2ei9j2f': '创建分支',
'i18n-buh24m5l': '请输入密码',
    'i18n-cdepvr38': '新增应用',
'i18n-cmfovsoe':
      '由50位字母、数字、点"."、中划线"-"或加号"+" 组成，且必须以数字开头，以数字或字母结尾',
    'i18n-ct3q2502': '当前状态',
    'i18n-cz07vq08': '刷新',
    'i18n-d2brlroc': '更新时间',
    'i18n-d9cz9maq': '请输入仓库地址，例http://192.168.1.1:80/repository',
    'i18n-duipg1h3': '查看',
    'i18n-dvhhy4bz': '发布中',
    'i18n-etgx4cun': '取消',
    'i18n-g1vk6fk1': '输入仓库名称搜索',
    'i18n-gklza56m': '添加组件仓库',
    'i18n-fmetyy4f': '分支管理',
    'i18n-gnabgk8z': '提交人',
    'i18n-godkp0bg': '用于出码时页面文件的命名，要符合 React 组件大驼峰命名要求',
'i18n-gu28o58e': '请先选择仓库',
    'i18n-hd27um9e': '同步删除当前仓库的所有发布记录',
    'i18n-hu8a4zhq': '测试',
'i18n-i44aj3t5': '仓库地址',
    'i18n-iiikgh5p': '应用名称',
    'i18n-io50zahr': '设计页面',
    'i18n-it3zdrk8': '删除',
'i18n-j30tafiu': '发布应用失败',
    'i18n-j8ze773g': '删除组件仓库成功',
    'i18n-jrlkaisr': '密码',
    'i18n-jw5stbdu': '还没有版本，可以在组件设计界面点击发布',
'i18n-jwiudi2n': '发布状态',
    'i18n-kzc8hlof': '源分支',
    'i18n-l30ktk9c': '应用管理',
    'i18n-l3bqhr6f': '属性设置',
    'i18n-l8bqf47j': '新增组件',
    'i18n-laqlm1vs': '流水线ID',
    'i18n-lc0lwakk': '请选择分支或版本',
    'i18n-lh9r0aur': '名称不能跟其他应用重复',
'i18n-m63pnjjo': '添加组件仓库失败',
    'i18n-mocj3t8i': '新分支名',
'i18n-my0gyopa': '仓库名称重复',
    'i18n-n65mm74u': '用户名',
    'i18n-na2etfio': '名称',
    'i18n-nk3u5cap': '版本管理',
    'i18n-o0ei2yue': '还没有页面，点击添加按钮创建',
'i18n-o241k589': '查看组件仓库',
    'i18n-o8oudbt6': '发布失败',
    'i18n-oqzjt4q8': '组件 ID',
    'i18n-pf9ss9vm': '描述',
    'i18n-prfr37uo': '设计组件',
'i18n-ptgr3r7b': '组件仓库管理',
    'i18n-q05eb4ej': '发布名称',
    'i18n-q95aq41k': '删除发布记录成功',
    'i18n-qd0chypg': '请选择CommitId',
    'i18n-qqphansg': '组件管理',
'i18n-qsr81tga': '否',
    'i18n-qxi7rhuh': '确定',
    'i18n-rai2jazr': '命名空间',
    'i18n-s4uc3qfq': '拥有者',
    'i18n-scef9t49': '新窗口预览',
    'i18n-sivgv5vw': '提交信息',
'i18n-sk0zlonj': '请输入 CommitId',
    'i18n-sk2miz3l': '输入成员名搜索',
    'i18n-t3krslmt': '测试',
'i18n-tbc50yra': '发布者',
    'i18n-tnmitd0v': '发布记录',
    'i18n-twtfn0kc': '组件仓库名称',
    'i18n-u58088zr': '删除组件仓库',
    'i18n-ubf2zl9c': '，发布至仓库：',
    'i18n-uel9pjrj': '操作',
'i18n-uhih9oip': '添加组件仓库成功',
    'i18n-uk1rth4d': '删除发布记录',
    'i18n-ukhgf87d': '请输入仓库地址',
    'i18n-umtxjgit': '请输入页面访问路径',
    'i18n-usdl74qf': '编辑组件仓库失败',
    'i18n-uu6jp4fr': '发布基线',
    'i18n-uvtyr9de': '更新者',
    'i18n-unauzwfe': '共计',
    'i18n-v88cpaiy': '应用 ID',
    'i18n-vc1z00ab': '成员名',
'i18n-vcavv6ts': '发布版本',
    'i18n-vmthidgk': '发布应用',
    'i18n-w3sx3iid': '关闭',
    'i18n-w5yp1cx8': '发布成功',
    'i18n-w6uloaol': '确定删除组件仓库',
    'i18n-w80normr': '请输入版本号',
    'i18n-wjytn4ph': '请输入仓库名称',
    'i18n-wo5d5bsf': '请选择分支',
    'i18n-wkyhbxzj': '条',
    'i18n-wtpamquq': '访客',
    'i18n-x0whqlmr': '移除成员',
    'i18n-xgcwv3vl': '请输入页面标题',
    'i18n-xm8m9oms': '完整分支名',
    'i18n-xvkn1o65': '角色',
'i18n-xwmo3gdd': '吗？',
    'i18n-xx5cxe33': '编辑组件仓库',
    'i18n-yhtaj9mp': '创建时间',
'i18n-ynxzg8x9': '编辑',
    'i18n-zbrcaqqo':
      "应用命名空间只能包含字母、数字、下划线 '_'、短横  '-'  和点号 '.'。不能以短横  '-'  开头，不能以 \".git\" 或 \".atom\" 结尾。",
'i18n-zkqmzk1j': '目前支持Chart Museum类型的helm仓库',
    'i18n-zupi1oqq': '此版本已完成发布，请修改版本号进行发布',
  },
};

const LOCALE_KEY = 'intl_locale';
let locale = window.localStorage.getItem(LOCALE_KEY);
if (!locale) {
  locale =
    typeof navigator === 'object' && typeof navigator.language === 'string'
      ? navigator.language
      : 'zh-CN';
}
if (locale.startsWith('en')) {
  locale = 'en-US';
} else {
  locale = 'zh-CN';
}

const getLocale = () => locale;

const setLocale = target => {
  locale = target;
  window.localStorage.setItem(LOCALE_KEY, target);
};

const isEmptyVariables = variables =>
  (Array.isArray(variables) && variables.length === 0) ||
  (typeof variables === 'object' && (!variables || Object.keys(variables).length === 0));

// 按低代码规范里面的要求进行变量替换
const format = (msg, variables) =>
  typeof msg === 'string'
    ? msg.replace(/\$?\{(\w+)\}/g, (match, key) => variables?.[key] ?? '')
    : msg;

const i18nFormat = ({ id, defaultMessage, fallback }, variables) => {
  const msg =
    i18nConfig[locale]?.[id] ?? i18nConfig[locale.replace('-', '_')]?.[id] ?? defaultMessage;
  if (msg == null) {
    console.warn('[i18n]: unknown message id: %o (locale=%o)', id, locale);
    return fallback === undefined ? `${id}` : fallback;
  }

  return format(msg, variables);
};

const i18n = (id, params) => {
  return i18nFormat({ id }, params);
};

// 将国际化的一些方法注入到目标对象&上下文中
const _inject2 = target => {
  target.i18n = i18n;
  target.getLocale = getLocale;
  target.setLocale = locale => {
    setLocale(locale);
    target.forceUpdate();
  };
  target._i18nText = t => {
    // 优先取直接传过来的语料
    const localMsg = t[locale] ?? t[String(locale).replace('-', '_')];
    if (localMsg != null) {
      return format(localMsg, t.params);
    }

    // 其次用项目级别的
    const projectMsg = i18nFormat({ id: t.key, fallback: null }, t.params);
    if (projectMsg != null) {
      return projectMsg;
    }

    // 兜底用 use 指定的或默认语言的
    return format(t[t.use || 'zh-CN'] ?? t.en_US, t.params);
  };

  // 注入到上下文中去
  if (target._context && target._context !== target) {
    Object.assign(target._context, {
      i18n,
      getLocale,
      setLocale: target.setLocale,
    });
  }
};

export { getLocale, setLocale, i18n, i18nFormat, _inject2 };
